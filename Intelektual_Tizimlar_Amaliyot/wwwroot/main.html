<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Intelektual tizimlar</title>
    <link href="bootstrap/bootstrap.css" rel="stylesheet" />
</head>
<body>
    <div class="container" style="margin-top:20px">
        <div class="row border" id="form" style="padding: 25px 0;">
        </div>
        <button type="button" class="btn btn-success" onclick={writeElements()} style="margin-top:10px">
            Saqlash
        </button>
    </div>

    <script>
        let inputsData = [];
        let buttonData = [];
        let count = 0;
        let buttonSeed = `<div class="col-md-1" style="">
                <button class="btn btn-danger" style="border-radius:50%; width:30px; height:30px; display:flex; align-items:center; justify-content:center;" type="button" onclick="removeElement()">-</button>
                <button class="btn btn-info" style="border-radius:50%; margin-top:10px; width:30px; height:30px; display:flex; align-items:center; justify-content:center;" type="button" onclick="writeElements()">+</button>
            </div>`;
        inputsData.push(GetSeedData(++count));
        writeElements();
     
        function writeElements() {
            inputsData.push(GetSeedData(++count));
            console.log(inputsData.join(''));
            document.getElementById('form').innerHTML = inputsData.join('') + buttonSeed;
        }

        function removeElement() {
            inputsData.pop();
            document.getElementById('form').innerHTML = inputsData.join('') + buttonSeed;
        }

        function getAtribute(atributeId) {
            let select = document.getElementById(atributeId);
            let countChild = select.childElementCount;
            if (countChild == 0) {
                var requestOptions = {
                    method: 'GET',
                    redirect: 'follow'
                };
                fetch("http://localhost:5000/api/Intelekt/GetAtributes", requestOptions)
                    .then(response => response.json())
                    .then(result => {
                        if (result.isSuccess) {
                            result.data.map(l => {
                                var option = document.createElement("option");
                                option.value = l.atributeId;
                                option.text = l.atributeName;
                                select.appendChild(option);
                            });
                        }
                    })
                    .catch(error => console.log('error', error));
            }
        }

        function getQiymat(qiymatId) {
            let select = document.getElementById(qiymatId);
            let countChild = select.childElementCount;
            if (countChild == 0) {
                var requestOptions = {
                    method: 'GET',
                    redirect: 'follow'
                };
                fetch("http://localhost:5000/api/Intelekt/GetConditions", requestOptions)
                    .then(response => response.json())
                    .then(result => {
                        if (result.isSuccess) {
                            result.data.map(l => {
                                var option = document.createElement("option");
                                option.value = l.conditionId;
                                option.text = l.conditionValue;
                                select.appendChild(option);
                            });
                        }
                    })
                    .catch(error => console.log('error', error));
            }
        }

        function GetSeedData(count) {
            return `<div class="col-md-2">
                <label for="atribute${count}">Atribute${count}</label>
                <select class="form-control" id="atribute${count}" onclick="{getAtribute('atribute${count}')}"></select>
            </div>
            <div class="col-md-2">
                <label for="qiymat${count}">Qiymat${count}</label>
                <select class="form-control" id="qiymat${count}" onclick="{getQiymat('qiymat${count}')}"></select>
            </div>`;
        }

        function CreateAtributeObject(index) {
            return [{
                label: {
                    for:  'atribute'+index,
                    text: 'Atribute'+index
                },
                select: {
                    className: 'form-control',
                    id: 'atribute'+index,
                    onClick: `{getAtribute('atribute${count}')}`,
                    options: []
                }
            },
            {
                label: {
                    for: 'qiymat'+index,
                    text: 'Qiymat'+index
                },
                select: {
                    className: 'form-control',
                    id: 'qiymat'+index,
                    onClick: `{getQiymat('qiymat${count}')}`,
                    options: []
                }
            }];
        }
        function ChangeModelToString()
        {
            let objectsStringFormat = [];
            inputsData.map((item) =>{
                var index = `<div class="col-md-2">
                <label for="${item.label.for}">${item.label.text}</label>
                <select class="${item.select.className}" id="${item.select.id}" onclick="${item.select.onClick}"></select>
            </div>`;
            });
        }
    </script>
</body>
</html>